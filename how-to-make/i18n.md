# Как настроить локализацию?

Если под локализацией вы подразумеваете то же, что и мы — перевод сайта на другие языки, — тогда вы, как и мы, 
заблуждаетесь. 

Читаем Википедию.

**Локализация** — процесс адаптации веб-приложения к культуре какой-либо страны. 

**Интернационализация** — технологические приёмы разработки, упрощающие адаптацию продукта к языковым и культурным 
особенностям регионов, отличных от того, в котором разрабатывался продукт.

Важное отличие одного от другого можно сформулировать совсем коротко. Интернационализация — это адаптация продукта 
для использования _в разных странах_, в то время как локализация — это добавление специальных функций для 
использования _в какой-то определённой стране_.

Мы, разработчики сайтов, говорим "локализация", но обычно подразумеваем только лишь перевод сайта на разные языки. 
А так как этот документ именно о переводах, придётся его переозаглавить.
 
# Как настроить интернационализацию?

В английском языке для слова `internationalization` принято сокращение `i18n`. При этом число `18` означает количество 
пропущенных между `i` и `n` букв. Для Локализации `Localization` применяют сокращение `L10n`. Заглавная буква `L` 
используется чтобы не путать с `i` в `L10n`, число `10` — количество букв между `L` и `n`.

Неудивительно, что инструменты, которые так или иначе связаны с интернационализацией, называются с использованием 
сокращения `i18n`. В `BEViS` мы не стали ломать привычки. Наши инструменты для интернационализации называются так же.

Освоить их проще простого, если вы вместе с нами освоили задания из последнего занятия про [yblock](yblock.md).

Теперь у вас есть страница `/pages/test-page/test-page.page.js`, на которой к этому моменту задекларирован один 
единственный блок `form`. Добавим в блок новую опцию `titleText`, в которую передадим произвольный текст. Его-то мы и
 будем переводить на разные языки. 
 
 У вас должна получиться такая структура:

```javascript
module.exports = function (pages) {
    pages.declare('test-page', function (params) {
        var options = params.options;
        return {
            block: 'page',
            title: 'test page',
            styles: [
                {url: options.assetsPath + '.css'}
            ],
            scripts: [
                {url: options.assetsPath + '.' + params.lang + '.js'}
            ],
            body: [
                {
                    block: 'form',
                    titleText: 'Лучший кофе на дороге'  // <---------- Новая опция
                }
            ]
        };
    });
}
```

Допишем шаблон для формы. Будем принимать опцию `titleText` и создавать элемент блока `head`, который в `DOM`-дереве 
будет представлен заголовком `h1` с переданным текстом.

Было:
```javascript
module.exports = function (bt) {

    bt.match('form', function (ctx) {
        ctx.enableAutoInit();

        ctx.setTag('span');

        ctx.setContent('Содержимое блока');
    });

};
```

Стало:
```javascript
module.exports = function (bt) {

    bt.match('form', function (ctx) {
        ctx.enableAutoInit();

        ctx.setTag('span');

        var title = ctx.getParam('titleText');
        ctx.setContent({
            elem: 'head',
            text: title
        });
    });

    bt.match('form__head', function (ctx) {
        ctx.setTag('h1');

        var headText = ctx.getParam('text');
        ctx.setContent(headText);
    });

};
```

_Я нарочно дал совершенно разные имена опциям шаблона и локальным переменным, чтобы вам было легче проследить, 
как текст "Лучший кофе на дороге" передаётся от опции `ctx.getParam('titleText')` до установки контента в 
`ctx.setContent(headText);`. Проследите-проследите :) Освежите свои знания про генерацию `HTML` из `BT`-шаблонов._ 

Обновим страницу `localhost:8080/test` в браузере и увидим огромный заголовок про кофе. Я вижу, а вы?

Очевидно, что в опцию `titleText` передавать готовую строку на русском языке нельзя. Надо передавать какой-то ключ, 
по которому нужно _где-то_ получать русский текст для интерфейса на русском языке, английский текст для 
интерфейса на английском языке, украинский для украинского, турецкий для турецкого и т.д.

Слово _где-то_ я выделил курсивом, чтобы сразу о нём поговорить. Невозможно локализировать сайт, не имея некоего 
хранилища переведённых текстов. В `BEViS` такое хранилище мы организовали в виде файлов. Создадим его вместе с вами.

Создайте папку `blocks/i18n/_keyset`.

Это будет специальное место, где будут храниться переводы всех блоков. Почему внутри папки `blocks/i18n` мы создали 
подпапку `_keyset` — об этом не задумывайтесь. Это всё обсудим позже. Сейчас переходим к самому интересному.  

Мы готовим переводы для блока `Form`, поэтому создадим набор ключей для этого блока. Набор ключей будем называть 
кисетом (если на ваш взгляд слово "кейсет" звучит лучше, называйте так). Давайте создадим кисет для формы.
   
Создаём папку `blocks/i18n/_keyset/i18n_keyset_form.i18n`. Опять же, пока не задумываемся, почему такое странное 
название у директории. А внутри неё создаём единственный (пока) языковой-файл `ru .js` и пишем в него единственный  
(пока) ключ с переводом:

`blocks/i18n/_keyset/i18n_keyset_form.i18n/ru.js`:
```javascript
module.exports = {
    "form": {
        "title-text": "Лучший кофе на дороге"
    }
};
```

Остановимся на содержимом подробнее.

Языковой файл `ru.js` — это обычный `Node.js`-модуль, который экспортирует объект с единственным полем, который мы 
назвали `form`. Мы назвали его так, чтобы имя кисета перекликалось с именем блока `Form`, который мы видим на 
web-странице. Когда имена перекликаются, так легче.

В этом файле сейчас мы описали только один ключ `title-text` и его значением сделали тот самый текст про кофе. Позже 
тут мы опишем ещё несколько ключей, а пока хватит и одного. Хранилище готово. Конечно, оно готово (пока!) только для 
русского языка, но сейчас нам этого достаточно.
 
Давайте сделаем так, чтобы приложение ходило за текстом про кофе именно в это хранилище.

Первое, что мы делаем всегда после создания нового блока, указываем зависимость — сообщаем, что такой-то 
блок будет использоваться на такой-то странице. 
  
Редактируем `pages/test-page/test-page.deps.yaml`, добавляемость зависимость к блоку (`i18n`) и указываем, какой именно
 кисет используется на этой странице (`form`): 
```
- page
- block: block
  elem: auto-init
- input
- super-input
- form
- block: i18n
  keyset: form
```

Всё. Теперь в декларации страницы убираем русский текст и просим вместо него ключ из хранилища:

```javascript
module.exports = function (pages) {
    pages.declare('test-page', function (params) {
        var options = params.options;
        return {
            block: 'page',
            title: 'test page',
            styles: [
                {url: options.assetsPath + '.css'}
            ],
            scripts: [
                {url: options.assetsPath + '.' + params.lang + '.js'}
            ],
            body: [
                {
                    block: 'form',
                    titleText: pages.i18n('form', 'title-text') // <------ Здесь зовём i18n-ключ
                }
            ]
        };
    });
};

```
 

 




 



