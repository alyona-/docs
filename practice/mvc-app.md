в разработке

# Используем `MVC`-концепцию в `BEViS`-проекте

Мы любим `MVC` за то, что эта концепция наводит порядок в проекте, сортирует компоненты кода по трём признакам — 
Модель, Представление и Контроллер. Отличную статью можно прочитать на 
[Вики](https://ru.wikipedia.org/wiki/Model-View-Controller).

Важно понимать, что в этом документе мы будем говорить о внедрении MVC в _клиентские модули_. Не в `bt`-шаблоны и не 
в серверный `js` из папки `server`. Мы внедрим `MVC` в код, который работает в браузере.

Когда мы говорим "внедрим `MVC`", это не означает, что мы станем внедрять какие-то одни фрагменты кода внутрь 
каких-то других фрагментов кода. Нет, конечно. `MVC` - лишь способ абстрактного отношения к своему коду и 
способ разделить ответственность, распределить роли между фрагментами кода ради того, чтобы уменьшить связность 
компонентов кода друг с другом, то есть чтобы изменение одного компонента не приводило к необходимости вносить 
изменения в работу другого. Для этого все компоненты кода разделяются на три условные группы, на три роли — модель, 
представление и контроллер. Модель отвечает за данные. Представление отвечает за отображение данных.  А контроллер — 
это мозговой центр программы, связывает модели и представления в единую систему.

_Строго говоря, согласиться с предыдущими словами можно только при условии, что мы описываем так называемую пассивную
 версию `MVC`, потому что в активной `MVC` мозговым центром программы является именно модель. Но, как интересно 
 подметили в статье на Вики, веб-разработчики пользуются пассивной MVC, потому что опыт программирования скриптов на PHP 
  испортил нас._

Мы будем строить приложение на основе пассивной `MVC`. И если вынырнуть из мира программирвоания и оглядеться вокруг,
  такое распределение ролей можно увидеть во ногих аспектах обычной жизни. 

Возьмём большой магазин, например, с бытовой техникой. 

Где-то на хозяйственном дворе за магазином есть складские помещения, и там работает складской рабочий. Его задача - 
получить новый товар от поставщиков. Те на фурах привозят товар, кладовщик его принимает и раскладывает на полках 
склада. Это одна его функция. Вторая функция кладовщика - отдать товар в магазин, когда из магазина придёт заявка с 
текстом: "Выдать столько-то микроволновок LG и столько-то телевизиров SONY Bravia." 

Кладовщик находит на полках склада нужные микроволновки и телевизиры и передаёт в магазин. Он не знает, кому он 
отдаёт товар — ему это знать не нужно. Не его это забота.
  
В то же время в самом магазине работает консультант. Его задача — принять откуда-то взявшиеся микроволновки и 
телевизоры и выставить их на полки магазина. Выставить аккуратно, развесить ценники, наклеить рекламки про скидки 
(консультант всё это знает, у него такая ответственность). Это одна из его функций. Вторая функция консультанта — 
общаться с покупателями. Слушать и отвечать на вопросы, взаимодействовать любыми способами, лишь бы товар купили.
 
Важно, что кладовщик не расставляет товар на полках магазина и не общается с покупателями. А консультант магазина не 
принимает товар от поставщиков на складе. Это в маленьком магазине работает один человек - он продавец, он же и 
кладовщик. А в больших магазинах приходится делить обязанности, чтобы не тормозить процесс. Было бы очень 
неэффективно и медленно, если бы один человек делал всё — принимал товар от поставщиков, потом оформлял бы его, потом 
расставлял по складу, потом нёс бы его в салон магазина, там расставлял и, уже порядком вспотевший и чертовски 
уставший, через силу улыбался бы покупателям и пытался бы отвечать на воопросы.
 
Кладовщик ведает только задачами склада. Консультант заниматеся только представлением товара на витринах и 
общением с покупателями. Эти два специалиста вообще не пересекаются и друг от друга не зависят. Так эффективнее.

И тут возникает ещё один сотрудник магазина, который должен организовать работу кладовщика и консультанта. Назовём 
его менеджером. Именно он опрашивает консультантов: "Сколько каких товаров нужно выставить на витрины", и пишет 
 заявку кладовщику: "Выдать столько-то микроволновок LG и столько-то телевизиров SONY Bravia." Именно он 
 переправляет этот товар со склада в помещение магазина (не сам, конечно, но процесс организовывает именно он).
 
Менеджер — мозговой центр, который организует потоки товара и связывает все другие роли в магазине в единое целое.

_Понятно, что в торговле есть ещё много других ролей и на тех же складах и в салоне магазина. Понятно, что и  
менеджеры делятся на какие-то категории, но это не меняет сути — в сложном процессе участвуют 
специализированные сотрудники, среди которых можно выделить три — получение + хранение товара, представление товара + 
общение с покупателями, управление потоками товара._

Аналогично магазину, в программирование привнесли те же три роли.

*Кладовщик - это Модель (`Model`)*
  
  * Кладовщик получает данные от поставщиков, а Модель получает данные из бекенда — из базы данных или из других 
  сервисов, обращаясь к ним по `HTTP`.
  
  * Кладовщик расставляет товар по полкам склада, а Модель сохраняет данные в каких-то внутренних объектах или массивах.
  
  * Кладовщик по заявке отпускает товар, а Модель отдаёт данные из своего хранилища. Как кладовщику, так и модели без 
  разницы, кто запросил данные — отдал и всё.

*Консультант - это Представление (`View`)*
  
  * Консультант расставляет товар в витринах, чтобы товар было хорошо видно. Представление отображает данные на 
веб-странице, навешивает стили, анимирует — отображает данные привлекательно. представление не знает откуда пришли 
данные. Это мы с вами знаем - они пришли из модели. 
 
  * Консультант слоняется между витринами в магазине и ждёт, пока потенциальный покупатель задаст ему вопрос о 
  микроволновке. Тогда Консультант покажет микроволновку со всех сторон, расскажет о ней. Представление точно так же 
  слушает пользовательские события на веб-странице (клики там, или чейнджи в инпутах) и как-то реагирует на эти 
  события. Например, по клику в инпут, `View` инпута, сделает вокруг инпута жёлтую фокусную рамку — поменяет 
  представление.
 
  * Когда Консультанта просят продать эту микроволновку с витрины, он относит её на кассу (менеджеру) и сообщает там,
   что товар хотят купить. Когда пользователь ввёл логин и пароль в форму авторизации и нажал Enter, Представление 
   формы читает тексты из полей логина и пароля и передаёт их Контроллеру. И больше вью формы ничего не делает — 
   только собирает данные от пользователя и отдаёт контроллеру.

*Менеджер - это Контроллер (`Controller`)*
  
  * Как Менеджер организует работу в магазине, так Контроллер организует работу `web`-приложения. Именно в файле  
  Контроллера начинается работа приложения. Имено здесь мы управляем, из каких Моделей нужно запросить данные. 
  Именно здесь мы полученные данные перенаправляем в Представления. Именно здесь мы получаем сообщения от View, что 
  пользователь ввёл "такой-то текст" в "таком-то" View и нажал сабмит. И делаем то, что нужно — отправляем этот текст
   в модель, чтобы передать данные в бекенд или ещё что-то, не знаю что.
    
Так устроено `javascript`-приложение на `MVC`. Всё три роли общаются друг с другом с помощью кастомных событий, мы о 
них немного уже говорили в [yblock.md](yblock.md).

Ещё мы с вами создавали три компонента — `Input`, `SuperInput` и `Form`. Все они согласно `MVC`-концепции - ни 
что иное, как Представления. То есть до сих пор в практикуме мы создавали только модули-представления и как-то их 
друг с другом связывали. Это всё было вью.


